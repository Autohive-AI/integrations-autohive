{
    "name": "Power BI",
    "version": "1.0.0",
    "description": "Power BI integration for managing workspaces, datasets, reports, and dashboards",
    "entry_point": "powerbi.py",
    "auth": {
        "type": "platform",
        "provider": "Power BI",
        "scopes": [
            "offline_access",
            "Dataset.Read.All",
            "Dataset.ReadWrite.All",
            "Report.Read.All",
            "Report.ReadWrite.All",
            "Dashboard.Read.All",
            "Workspace.Read.All",
            "Workspace.ReadWrite.All",
            "Content.Create",
            "Tenant.Read.All",
            "Tenant.ReadWrite.All"
        ]
    },
    "actions": {
        "list_workspaces": {
            "display_name": "List Workspaces",
            "description": "Get a list of all Power BI workspaces",
            "input_schema": {
                "type": "object",
                "properties": {
                    "filter": {
                        "type": "string",
                        "description": "Optional OData filter expression"
                    },
                    "top": {
                        "type": "integer",
                        "description": "Maximum number of workspaces to return",
                        "default": 100
                    }
                }
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "workspaces": {
                        "type": "array",
                        "description": "List of workspaces",
                        "items": {
                            "type": "object",
                            "properties": {
                                "id": {"type": "string"},
                                "name": {"type": "string"},
                                "isReadOnly": {"type": "boolean"},
                                "isOnDedicatedCapacity": {"type": "boolean"},
                                "type": {"type": "string"}
                            }
                        }
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["workspaces", "result"]
            }
        },
        "get_workspace": {
            "display_name": "Get Workspace",
            "description": "Get details of a specific Power BI workspace",
            "input_schema": {
                "type": "object",
                "properties": {
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID"
                    }
                },
                "required": ["workspace_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "workspace": {
                        "type": "object",
                        "description": "Workspace details"
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["workspace", "result"]
            }
        },
        "list_datasets": {
            "display_name": "List Datasets",
            "description": "Get a list of datasets in a workspace",
            "input_schema": {
                "type": "object",
                "properties": {
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                }
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "datasets": {
                        "type": "array",
                        "description": "List of datasets",
                        "items": {
                            "type": "object",
                            "properties": {
                                "id": {"type": "string"},
                                "name": {"type": "string"},
                                "configuredBy": {"type": "string"},
                                "isRefreshable": {"type": "boolean"},
                                "isEffectiveIdentityRequired": {"type": "boolean"},
                                "isEffectiveIdentityRolesRequired": {"type": "boolean"},
                                "isOnPremGatewayRequired": {"type": "boolean"}
                            }
                        }
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["datasets", "result"]
            }
        },
        "get_dataset": {
            "display_name": "Get Dataset",
            "description": "Get details of a specific dataset",
            "input_schema": {
                "type": "object",
                "properties": {
                    "dataset_id": {
                        "type": "string",
                        "description": "The dataset ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                },
                "required": ["dataset_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "dataset": {
                        "type": "object",
                        "description": "Dataset details"
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["dataset", "result"]
            }
        },
        "refresh_dataset": {
            "display_name": "Refresh Dataset",
            "description": "Trigger a refresh for a Power BI dataset with support for enhanced refresh options",
            "input_schema": {
                "type": "object",
                "properties": {
                    "dataset_id": {
                        "type": "string",
                        "description": "The dataset ID to refresh"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    },
                    "notify_option": {
                        "type": "string",
                        "description": "Mail notification options (NoNotification, MailOnFailure, or MailOnCompletion). Not applicable for enhanced refresh or service principal operations.",
                        "enum": ["NoNotification", "MailOnFailure", "MailOnCompletion"]
                    },
                    "type": {
                        "type": "string",
                        "description": "The type of processing to perform (Full, ClearValues, Calculate, DataOnly, Automatic, or Defragment)",
                        "enum": ["Full", "ClearValues", "Calculate", "DataOnly", "Automatic", "Defragment"]
                    },
                    "commit_mode": {
                        "type": "string",
                        "description": "Determines if objects will be committed in batches (PartialBatch) or only when complete (Transactional)",
                        "enum": ["Transactional", "PartialBatch"]
                    },
                    "max_parallelism": {
                        "type": "integer",
                        "description": "The maximum number of threads on which to run parallel processing commands"
                    },
                    "retry_count": {
                        "type": "integer",
                        "description": "Number of times the operation will retry before failing"
                    },
                    "objects": {
                        "type": "array",
                        "description": "An array of objects (tables/partitions) to be processed for selective refresh",
                        "items": {
                            "type": "object",
                            "properties": {
                                "table": {
                                    "type": "string",
                                    "description": "Table name to refresh"
                                },
                                "partition": {
                                    "type": "string",
                                    "description": "Partition name to refresh (optional)"
                                }
                            },
                            "required": ["table"]
                        }
                    },
                    "apply_refresh_policy": {
                        "type": "boolean",
                        "description": "Determine if the incremental refresh policy is applied or not"
                    },
                    "effective_date": {
                        "type": "string",
                        "description": "If an incremental refresh policy is applied, this parameter overrides the current date (ISO 8601 format)"
                    },
                    "timeout": {
                        "type": "string",
                        "description": "Timeout duration in HH:MM:SS format (e.g., '05:00:00' for 5 hours). Maximum total duration including retries cannot exceed 24 hours.",
                        "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                    }
                },
                "required": ["dataset_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "result": {"type": "boolean"},
                    "message": {"type": "string"},
                    "request_id": {"type": "string"}
                },
                "required": ["result"]
            }
        },
        "get_refresh_history": {
            "display_name": "Get Dataset Refresh History",
            "description": "Get the refresh history for a dataset",
            "input_schema": {
                "type": "object",
                "properties": {
                    "dataset_id": {
                        "type": "string",
                        "description": "The dataset ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    },
                    "top": {
                        "type": "integer",
                        "description": "Maximum number of refresh records to return",
                        "default": 10
                    }
                },
                "required": ["dataset_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "refreshes": {
                        "type": "array",
                        "description": "List of refresh records",
                        "items": {
                            "type": "object",
                            "properties": {
                                "refreshType": {"type": "string"},
                                "startTime": {"type": "string"},
                                "endTime": {"type": "string"},
                                "status": {"type": "string"},
                                "requestId": {"type": "string"}
                            }
                        }
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["refreshes", "result"]
            }
        },
        "list_reports": {
            "display_name": "List Reports",
            "description": "Get a list of reports in a workspace",
            "input_schema": {
                "type": "object",
                "properties": {
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                }
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "reports": {
                        "type": "array",
                        "description": "List of reports",
                        "items": {
                            "type": "object",
                            "properties": {
                                "id": {"type": "string"},
                                "name": {"type": "string"},
                                "webUrl": {"type": "string"},
                                "embedUrl": {"type": "string"},
                                "datasetId": {"type": "string"}
                            }
                        }
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["reports", "result"]
            }
        },
        "get_report": {
            "display_name": "Get Report",
            "description": "Get details of a specific report",
            "input_schema": {
                "type": "object",
                "properties": {
                    "report_id": {
                        "type": "string",
                        "description": "The report ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                },
                "required": ["report_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "report": {
                        "type": "object",
                        "description": "Report details"
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["report", "result"]
            }
        },
        "get_report_datasources": {
            "display_name": "Get Report Datasources",
            "description": "Get a list of data sources for the specified paginated report (RDL)",
            "input_schema": {
                "type": "object",
                "properties": {
                    "report_id": {
                        "type": "string",
                        "description": "The report ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                },
                "required": ["report_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "datasources": {
                        "type": "array",
                        "description": "List of data sources",
                        "items": {
                            "type": "object",
                            "properties": {
                                "datasourceType": {"type": "string"},
                                "datasourceId": {"type": "string"},
                                "gatewayId": {"type": "string"},
                                "name": {"type": "string"},
                                "connectionString": {"type": "string"},
                                "connectionDetails": {
                                    "type": "object",
                                    "description": "Data source connection details"
                                }
                            }
                        }
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["datasources", "result"]
            }
        },
        "clone_report": {
            "display_name": "Clone Report",
            "description": "Clone a Power BI report",
            "input_schema": {
                "type": "object",
                "properties": {
                    "report_id": {
                        "type": "string",
                        "description": "The report ID to clone"
                    },
                    "name": {
                        "type": "string",
                        "description": "Name for the cloned report"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "Source workspace ID (optional, defaults to My workspace)"
                    },
                    "target_workspace_id": {
                        "type": "string",
                        "description": "Target workspace ID (optional, defaults to source workspace)"
                    },
                    "target_dataset_id": {
                        "type": "string",
                        "description": "Target dataset ID for the cloned report (optional)"
                    }
                },
                "required": ["report_id", "name"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "id": {"type": "string"},
                    "name": {"type": "string"},
                    "webUrl": {"type": "string"},
                    "embedUrl": {"type": "string"},
                    "result": {"type": "boolean"}
                },
                "required": ["result"]
            }
        },
        "refresh_report": {
            "display_name": "Refresh Report",
            "description": "Refresh the dataset associated with a Power BI report",
            "input_schema": {
                "type": "object",
                "properties": {
                    "report_id": {
                        "type": "string",
                        "description": "The report ID whose dataset should be refreshed"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    },
                    "notify_option": {
                        "type": "string",
                        "description": "Notification option (NoNotification or MailOnFailure)",
                        "enum": ["NoNotification", "MailOnFailure"],
                        "default": "NoNotification"
                    }
                },
                "required": ["report_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "result": {"type": "boolean"},
                    "message": {"type": "string"},
                    "dataset_id": {"type": "string"}
                },
                "required": ["result"]
            }
        },
        "export_report": {
            "display_name": "Export Report to File",
            "description": "Export a Power BI report to PDF, PPTX, or PNG",
            "input_schema": {
                "type": "object",
                "properties": {
                    "report_id": {
                        "type": "string",
                        "description": "The report ID to export"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    },
                    "format": {
                        "type": "string",
                        "description": "Export format",
                        "enum": ["PDF", "PPTX", "PNG"],
                        "default": "PDF"
                    }
                },
                "required": ["report_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "export_id": {"type": "string"},
                    "result": {"type": "boolean"},
                    "message": {"type": "string"}
                },
                "required": ["result"]
            }
        },
        "get_export_status": {
            "display_name": "Get Export Status",
            "description": "Get the status of a report export operation",
            "input_schema": {
                "type": "object",
                "properties": {
                    "report_id": {
                        "type": "string",
                        "description": "The report ID"
                    },
                    "export_id": {
                        "type": "string",
                        "description": "The export ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                },
                "required": ["report_id", "export_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "status": {"type": "string"},
                    "percentComplete": {"type": "integer"},
                    "result": {"type": "boolean"}
                },
                "required": ["status", "result"]
            }
        },
        "list_dashboards": {
            "display_name": "List Dashboards",
            "description": "Get a list of dashboards in a workspace",
            "input_schema": {
                "type": "object",
                "properties": {
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                }
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "dashboards": {
                        "type": "array",
                        "description": "List of dashboards",
                        "items": {
                            "type": "object",
                            "properties": {
                                "id": {"type": "string"},
                                "displayName": {"type": "string"},
                                "isReadOnly": {"type": "boolean"},
                                "embedUrl": {"type": "string"}
                            }
                        }
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["dashboards", "result"]
            }
        },
        "get_dashboard": {
            "display_name": "Get Dashboard",
            "description": "Get details of a specific dashboard",
            "input_schema": {
                "type": "object",
                "properties": {
                    "dashboard_id": {
                        "type": "string",
                        "description": "The dashboard ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                },
                "required": ["dashboard_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "dashboard": {
                        "type": "object",
                        "description": "Dashboard details"
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["dashboard", "result"]
            }
        },
        "get_dashboard_tiles": {
            "display_name": "Get Dashboard Tiles",
            "description": "Get tiles from a specific dashboard",
            "input_schema": {
                "type": "object",
                "properties": {
                    "dashboard_id": {
                        "type": "string",
                        "description": "The dashboard ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    }
                },
                "required": ["dashboard_id"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "tiles": {
                        "type": "array",
                        "description": "List of dashboard tiles",
                        "items": {
                            "type": "object",
                            "properties": {
                                "id": {"type": "string"},
                                "title": {"type": "string"},
                                "embedUrl": {"type": "string"},
                                "datasetId": {"type": "string"},
                                "reportId": {"type": "string"}
                            }
                        }
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["tiles", "result"]
            }
        },
        "execute_queries": {
            "display_name": "Execute DAX Queries",
            "description": "Execute DAX queries against a dataset",
            "input_schema": {
                "type": "object",
                "properties": {
                    "dataset_id": {
                        "type": "string",
                        "description": "The dataset ID"
                    },
                    "workspace_id": {
                        "type": "string",
                        "description": "The workspace ID (optional, defaults to My workspace)"
                    },
                    "queries": {
                        "type": "array",
                        "description": "List of DAX queries to execute",
                        "items": {
                            "type": "object",
                            "properties": {
                                "query": {
                                    "type": "string",
                                    "description": "DAX query string"
                                }
                            }
                        }
                    }
                },
                "required": ["dataset_id", "queries"]
            },
            "output_schema": {
                "type": "object",
                "properties": {
                    "results": {
                        "type": "array",
                        "description": "Query results"
                    },
                    "result": {"type": "boolean"}
                },
                "required": ["results", "result"]
            }
        }
    }
}
